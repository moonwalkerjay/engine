module.exports=function(){"use strict";function t(){if(typeof window.performance==="undefined"){window.performance={}}if(!window.performance.now){var t=Date.now();if(performance.timing&&performance.timing.navigationStart){t=performance.timing.navigationStart}window.performance.now=function e(){return Date.now()-t}}if(!window.performance.mark){window.performance.mark=function(){}}if(!window.performance.measure){window.performance.measure=function(){}}if(!window.performance.memory){window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}}}var e=function t(e,a){this._color=a||"#666";this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvasDot=document.createElement("canvas");this._ctxDot=this._canvasDot.getContext("2d");this._canvasAlarm=document.createElement("canvas"),this._ctxAlarm=this._canvasAlarm.getContext("2d");this._canvas.className="pstats-canvas";e.appendChild(this._canvas)};e.prototype.init=function t(e,a){this._canvas.width=e;this._canvas.height=a;this._canvas.style.width=e+"px";this._canvas.style.height=a+"px";this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,e,a);this._canvasDot.width=1;this._canvasDot.height=2*a;this._ctxDot.fillStyle="#444";this._ctxDot.fillRect(0,0,1,2*a);this._ctxDot.fillStyle=this._color;this._ctxDot.fillRect(0,a,1,a);this._ctxDot.fillStyle="#fff";this._ctxDot.globalAlpha=.5;this._ctxDot.fillRect(0,a,1,1);this._ctxDot.globalAlpha=1;this._canvasAlarm.width=1;this._canvasAlarm.height=2*a;this._ctxAlarm.fillStyle="#444";this._ctxAlarm.fillRect(0,0,1,2*a);this._ctxAlarm.fillStyle="#b70000";this._ctxAlarm.fillRect(0,a,1,a);this._ctxAlarm.globalAlpha=.5;this._ctxAlarm.fillStyle="#fff";this._ctxAlarm.fillRect(0,a,1,1);this._ctxAlarm.globalAlpha=1};var a=function(t){function e(e,a){t.call(this,e,a);this._current=0;this._max=0}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype.draw=function t(e,a){this._current+=(e-this._current)*.1;this._max*=.99;if(this._current>this._max){this._max=this._current}var i=Math.round(-this._canvas.height*this._current/this._max);this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);if(a){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,i)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,i)}};return e}(e);var i=function(t){function e(e,a){t.call(this,e,a);this._threshold=0;this._canvas2=document.createElement("canvas");this._ctx2=this._canvas2.getContext("2d")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype.init=function e(a,i){t.prototype.init.call(this,a,i);this._canvas2.width=a;this._canvas2.height=i;this._ctx2.fillStyle="#444";this._ctx2.fillRect(0,0,a,i)};e.prototype.draw=function t(e,a){if(e>this._threshold){var i=(e-e%this._canvas.height)/this._canvas.height;var n=this._canvas.height*(i+1);var s=this._threshold;this._threshold=n;var r=s/n;this._ctx2.drawImage(this._canvas,0,0);this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height);this._ctx.drawImage(this._canvas2,1,0,this._canvas.width-1,this._canvas.height,0,(1-r)*this._canvas.height,this._canvas.width-1,this._canvas.height)}else{this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height)}var o=Math.round(-this._canvas.height*e/this._threshold);if(a){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,o)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,o)}};return e}(e);var n=function(t){function e(e,a,i,n){t.call(this,e,a);this._min=i;this._max=n}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype.draw=function t(e,a){var i=(e-this._min)/(this._max-this._min);var n=-Math.ceil(this._canvas.height*i);this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);if(a){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,n)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,n)}};return e}(e);var s=function t(e,a){this._colors=a;this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvas.className="pstats-canvas";e.appendChild(this._canvas)};s.prototype.init=function t(e,a,i){this._canvas.width=e;this._canvas.height=a*i;this._canvas.style.width=e+"px";this._canvas.style.height=a*i+"px";this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,e,a*i)};s.prototype.draw=function t(e){var a=this;this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);var i=0;for(var n=0;n<e.length;++n){var s=e[n]*a._canvas.height;a._ctx.fillStyle=a._colors[n];a._ctx.fillRect(a._canvas.width-1,i,1,s);i+=s}};var r=function t(e,a){this._id=e;this._opts=a||{};this._value=0;this._total=0;this._averageValue=0;this._accumValue=0;this._accumSamples=0;this._accumStart=window.performance.now()};var o={value:{}};r.prototype._average=function t(e){if(this._opts.average){this._accumValue+=e;++this._accumSamples;var a=performance.now();if(a-this._accumStart>=this._opts.average){this._averageValue=this._accumValue/this._accumSamples;this._accumValue=0;this._accumStart=a;this._accumSamples=0}}};o.value.get=function(){return this._value};o.value.set=function(t){this._value=t};r.prototype.sample=function t(){this._average(this._value)};r.prototype.human=function t(){var e=this._opts.average?this._averageValue:this._value;return Math.round(e*100)/100};r.prototype.alarm=function t(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over};Object.defineProperties(r.prototype,o);var c=function(t){function e(e,a){t.call(this,e,a);this._time=window.performance.now()}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype.start=function t(){this._time=window.performance.now()};e.prototype.end=function t(){this._value=window.performance.now()-this._time;this._average(this._value)};e.prototype.tick=function t(){this.end();this.start()};e.prototype.frame=function t(){var e=window.performance.now();var a=e-this._time;this._total++;var i=this._opts.average||1e3;if(a>i){this._value=this._total*1e3/a;this._total=0;this._time=e;this._average(this._value)}};return e}(r);var h=Math.log(1024);var l=["Bytes","KB","MB","GB","TB"];function _(t){var e=100;var a=Math.floor(Math.log(t)/h);if(t===0){return"n/a"}return Math.round(t*e/Math.pow(1024,a))/e+" "+l[a]}var v=function(t){function e(e,a,i){t.call(this,a,i);this._stats=e;this._start=0;if(i.extension.indexOf("memory.")===0){this._field=i.extension.substring(7)}}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype.snapshot=function t(){this._value=this._stats[this._field]};e.prototype.start=function t(){this._start=this._stats[this._field]};e.prototype.end=function t(){this._value=this._stats[this._field]-this._start};e.prototype.human=function e(){return _(t.prototype.human.call(this))};return e}(r);var p=function t(){var e=window.performance.memory;if(e.totalJSHeapSize===0){console.warn("totalJSHeapSize === 0, performance.memory is only available in Chrome.")}this._used=0;this._total=0;this._lastUsed=0};var u={alarm:{},used:{},total:{}};p.prototype.tick=function t(){this._lastUsed=this._used;this._used=window.performance.memory.usedJSHeapSize;this._total=window.performance.memory.totalJSHeapSize};u.alarm.get=function(){return this._used-this._lastUsed<0};u.used.get=function(){return window.performance.memory.usedJSHeapSize};u.total.get=function(){return this._total};p.prototype.counter=function t(e,a){return new v(this,e,a)};Object.defineProperties(p.prototype,u);var d={memory:p};var f=100;var m=10;var x="\n  .pstats {\n    position: absolute;\n    z-index: 9999;\n\n    padding: 5px;\n    width: "+(f+150)+"px;\n    right: 0;\n    bottom: 0;\n\n    font-size: 10px;\n    font-family: 'Roboto Condensed', tahoma, sans-serif;\n    overflow: hidden;\n    user-select: none;\n    cursor: default;\n\n    background: #222;\n    border-radius: 3px;\n\n  }\n\n  .pstats-container {\n    display: flex;\n    flex-direction: column;\n    color: #888;\n    white-space: nowrap;\n  }\n\n  .pstats-item {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n  }\n\n  .pstats-label {\n    display: flex;\n    flex-direction: row;\n    flex: 1;\n\n    text-align: left;\n    margin-right: 5px;\n\n    transition: background 0.3s;\n  }\n\n  .pstats-label.alarm {\n    color: #ccc;\n    background: #800;\n\n    transition: background 0s;\n  }\n\n  .pstats-counter-id {\n    flex: 1;\n  }\n\n  .pstats-counter-value {\n    flex: 1;\n    text-align: right;\n  }\n\n  .pstats-fraction {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    margin-top: 1px;\n    margin-bottom: 1px;\n  }\n\n  .pstats-legend {\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n\n    text-align: right;\n    margin-right: 5px;\n  }\n";var w=document.createElement("style");w.type="text/css";w.textContent=x;document.head.appendChild(w);var g=function t(e,r){var o=this;r=r||{};this._values=r.values||{};this._fractions=r.fractions||[];this._id2counter={};this._id2item={};this._name2extStats={};if(r.css){var c=document.createElement("style");c.type="text/css";c.textContent=r.css;document.head.appendChild(c)}if(r.extensions){for(var h=0;h<r.extensions.length;++h){var l=r.extensions[h];var _=d[l];if(!_){console.warn("Can not find extensions "+l+", please register your extension via pstats.register().");continue}o._name2extStats[l]=new _}}this._root=document.createElement("div");this._root.className="pstats";var v=document.createElement("div");v.className="pstats-container";this._root.appendChild(v);for(var p in o._values){var u=o._values[p];var x=document.createElement("div");x.className="pstats-item";var w=document.createElement("div");w.className="pstats-label";var g=document.createElement("span");g.className="pstats-counter-id";g.textContent=u.desc||p;var y=document.createElement("div");y.className="pstats-counter-value";var S=document.createTextNode("");S.nodeValue="0";w.appendChild(g);w.appendChild(y);y.appendChild(S);x.appendChild(w);var b=void 0;if(u.min!==undefined||u.max!==undefined){b=new n(x,u.color,u.min||0,u.max||9999)}else if(u.threshold){b=new i(x,u.color)}else{b=new a(x,u.color)}b.init(f,m);o._id2item[p]={label:w,valueText:S,graph:b};v.appendChild(x)}if(r.fractions){for(var C=0;C<r.fractions.length;++C){var A=r.fractions[C];A.colors=A.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];var D=document.createElement("div");D.className="pstats-fraction";var E=document.createElement("div");E.className="pstats-legend";var I=A.steps;for(var R=0;R<I.length;++R){var k=document.createElement("span");k.textContent=I[R];k.style.color=A.colors[R];E.appendChild(k)}D.appendChild(E);D.style.height=I.length*m+"px";var N=new s(D,A.colors);N.init(f,m,I.length);A.graph=N;A.values=new Array(I.length);v.appendChild(D)}}e.appendChild(this._root)};g.prototype.item=function t(e){if(!e){return null}var a=this._id2counter[e];if(a){return a}var i=this._values[e];if(!i){return null}if(i.extension){var n=i.extension.indexOf(".");var s=i.extension.substring(0,n);var r=this._name2extStats[s];if(!r){console.error("extension "+s+" not found, make sure you have register and enable it.");return null}a=r.counter(e,i)}else{a=new c(e,i)}this._id2counter[e]=a;return a};g.prototype.tick=function t(){var e=this;for(var a in e._name2extStats){var i=e._name2extStats[a];i.tick()}for(var n in e._values){var s=e._id2counter[n];if(s){s.sample();var r=s.alarm();var o=s.human();var c=e._id2item[n];c.label.classList.toggle("alarm",r>0);c.valueText.nodeValue=o;c.graph.draw(s.value,r)}}for(var h=0;h<this._fractions.length;++h){var l=e._fractions[h];var _=e._id2counter[l.base];if(_){var v=l.steps;for(var p=0;p<v.length;++p){var u=v[p];var d=e._id2counter[u];if(d){l.values[p]=d.value/_.value}}l.graph.draw(l.values)}}};t();var y={new:function t(e,a){var i=new g(e,a);return function(t){if(!t){return i}return i.item(t)}},register:function t(e,a){d[e]=a}};return y}();
